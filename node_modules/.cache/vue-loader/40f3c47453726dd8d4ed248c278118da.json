{"remainingRequest":"/Users/yushengnan/ysn/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yushengnan/ysn/src/views/studentView/unPayed/index.vue?vue&type=style&index=0&id=93214c90&scoped=true&lang=less&","dependencies":[{"path":"/Users/yushengnan/ysn/src/views/studentView/unPayed/index.vue","mtime":1618572471832},{"path":"/Users/yushengnan/ysn/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIi4uL3N0eWxlLmxlc3MiOwoucGF5RG9tIHsKICAuY29udGVudCB7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA3MHB4OwogICAgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOwogICAgLypwYWRkaW5nOjYwcHggMTBweCAxMHB4IDEwcHg7Ki8KICAgIGJvcmRlci1yYWRpdXM6IDJweDsKICAgIC8qZGlzcGxheTogZmxleDsqLwogICAgLyogIGp1c3RpZnktY29udGVudDogY2VudGVyOyovCiAgICAvKmZsZXgtZmxvdzpub3dyYXA7Ki8KICAgIC8qZmxleC1kaXJlY3Rpb246Y29sdW1uOyovCgogICAgLm1vZGFsIHsKICAgICAgL2RlZXAvIC5hbnQtbW9kYWwgewogICAgICAgIHdpZHRoOiA5MDBweDsKICAgICAgICBtaW4td2lkdGg6IDkwMHB4OwogICAgICB9CgogICAgICAvZGVlcC8gLmFudC1hbGVydCB7CiAgICAgICAgcGFkZGluZzogNXB4IDVweCA1cHggMTVweDsKICAgICAgICBmb250LXNpemU6IDEycHg7CgogICAgICAgIC5hbnQtYWxlcnQtaWNvbiB7CiAgICAgICAgICB0b3A6IDhweDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgLnBheSB7CiAgICAuYm9yZGVyU3R5bGUgewogICAgICBib3JkZXItY29sb3I6ICMxODkwZmY7CiAgICB9CiAgICAvZGVlcC8gLmFudC1idG4gewogICAgICBoZWlnaHQ6IGF1dG87CiAgICAgIHBhZGRpbmc6IDEwcHggMTVweDsKICAgIH0KICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/studentView/unPayed","sourcesContent":["<template>\r\n  <!--  <page-header-wrapper>-->\r\n  <!--    <template v-slot:content>-->\r\n  <!--      <div class=\"page-header-content\">-->\r\n  <!--      </div>-->\r\n  <!--    </template>-->\r\n  <!--    <a-spin tip=\"Loading...\">-->\r\n  <!--        <div class=\"spin-content\">-->\r\n  <div style=\"position:relative\" class=\"payDom\">\r\n    <div class=\"content\" :style=\"{width:$store.getters.isMobile ? '90%' : '450px'}\">\r\n      <div style=\"width:100%\">\r\n        <a-checkbox :checked=\"allChecked\" @change=\"selectAll\" style=\"margin-right:10px;\">\r\n          全选\r\n        </a-checkbox>\r\n        <a-button v-if=\"toPayButton\" type=\"primary\" @click=\"submitPay\">提交付款</a-button>\r\n      </div>\r\n      <div>\r\n        <a-list item-layout=\"horizontal\" :data-source=\"data\">\r\n          <a-list-item slot=\"renderItem\" slot-scope=\"item\">\r\n            <a-checkbox :disabled=\"item.must === 1\" :checked=\"item.checked\" @change=\"(e)=>selectBook(e,item.teachingMaterialId)\" style=\"margin-right:10px;\">\r\n            </a-checkbox>\r\n            <a-list-item-meta\r\n              :description=\"`折扣价格：${item.finalPrice}`\"\r\n            >\r\n              <a slot=\"title\">{{ item.teachingMaterialName }}</a>\r\n            </a-list-item-meta>\r\n          </a-list-item>\r\n        </a-list>\r\n      </div>\r\n    </div>\r\n    <!--      <div class=\"table\" style=\"margin-top:10px;width:80%;display: inline-block\">-->\r\n    <!--        <a-table-->\r\n    <!--          :row-selection=\"{ selectedRowKeys: selectedRowKeys,getCheckboxProps:getCheckboxProps, onChange: onSelectChange }\"-->\r\n    <!--          :columns=\"columns\"-->\r\n    <!--          :data-source=\"data\"-->\r\n    <!--          @change=\"changePage\"-->\r\n    <!--          :loading=\"loading\"-->\r\n    <!--          :pagination=\"pagination\"-->\r\n    <!--          :rowKey=\"record=>record.teachingMaterialId\"-->\r\n    <!--        >-->\r\n    <!--          <span slot=\"action\" slot-scope=\"text,record\">-->\r\n    <!--            <a @click=\"onShow(record)\">付款</a>-->\r\n    <!--          </span>-->\r\n    <!--          <template slot=\"footer\" v-if=\"data&&data.length>0\">-->\r\n    <!--            <a-button type=\"primary\" @click=\"submitPay\">提交付款</a-button>-->\r\n    <!--          </template>-->\r\n    <!--        </a-table>-->\r\n    <!--      </div>-->\r\n    <!--      弹出框支付-->\r\n    <div class=\"modal\" ref=\"modal\">\r\n      <a-modal\r\n        title=\"支付\"\r\n        :visible=\"visible\"\r\n        @cancel=\"OnCancel\"\r\n        :footer=\"false\"\r\n        destroyOnClose\r\n        :getContainer=\"()=>this.$refs.modal\"\r\n      >\r\n        <div class=\"pay\">\r\n          <div style=\"text-align: center;font-weight: bold;margin-bottom:20px;\">点击下方按钮可以切换支付方式，默认支付宝支付</div>\r\n          <div style=\"text-align: center;margin-bottom:20px;\">\r\n            <a-button @click=\"payTypeFun(1)\" type=\"dashed\" :style=\"{marginRight:'30px'}\" :class=\"payType ? 'borderStyle' : ''\">\r\n              <IconFont type=\"icon-weixinzhifu\" style=\"width:40px;height:40px;display: inline-block;font-size: 40px\"/>\r\n            </a-button>\r\n            <a-button @click=\"payTypeFun(0)\" type=\"dashed\" :class=\"!payType ? 'borderStyle' : ''\">\r\n              <IconFont type=\"icon-zhifubao\" style=\"width:40px;height:40px;display: inline-block;font-size: 40px\"/>\r\n            </a-button>\r\n          </div>\r\n          <div style=\"height:400px;\">\r\n            <a-spin tip=\"Loading...\" :spinning=\"spinning\">\r\n              <div class=\"spin-content\">\r\n                <div style=\"width:300px;margin:0 auto;margin-bottom:20px;\"><a-alert :message=\"message\" type=\"info\" :style=\"{width:$store.getters.isMobile ? '280px' : '300px'}\"/></div>\r\n                <div style=\"width:200px;margin:0 auto\" id=\"qrcode\" class=\"qrcode\" ref=\"qrcode\"></div>\r\n              </div>\r\n            </a-spin>\r\n          </div>\r\n        </div>\r\n      </a-modal>\r\n      <!--      -->\r\n      <a-modal\r\n        v-if=\"$store.getters.userInfo.notice\"\r\n        title=\"公告\"\r\n        :visible=\"visibleNotice\"\r\n        @cancel=\"visibleNotice = false\"\r\n        :footer=\"false\"\r\n        destroyOnClose\r\n        :getContainer=\"()=>this.$refs.modal\"\r\n      >\r\n        <div style=\"min-height:500px\">{{ $store.getters.userInfo.notice }}</div>\r\n      </a-modal>\r\n      <!--      </div>-->\r\n    </div>\r\n  </div>\r\n<!--        </div>-->\r\n<!--    </a-spin>-->\r\n<!--  </page-header-wrapper>-->\r\n</template>\r\n\r\n<script>\r\n  import GlobalForm from '@/components/GlobalForm'\r\n  // import QRcode from 'qrcode'\r\n  import QRCode from 'qrcodejs2'// 引入方法\r\n  import { formData } from './formData'\r\n  import { services } from './service'\r\n\r\n  const columns = [\r\n    {\r\n      title: '课程名称',\r\n      dataIndex: 'name',\r\n      key: 'name'\r\n    },\r\n    {\r\n      title: '教材名称',\r\n      dataIndex: 'teachingMaterialName',\r\n      key: 'teachingMaterialName'\r\n    },\r\n    {\r\n      title: '应付金额',\r\n      dataIndex: 'finalPrice',\r\n      key: 'finalPrice'\r\n    }\r\n    // {\r\n    //   title: '班级',\r\n    //   dataIndex: 'className',\r\n    //   key: 'className'\r\n    // },\r\n    // {\r\n    //   title: '是否付款',\r\n    //   dataIndex: 'payed',\r\n    //   key: 'payed'\r\n    // },\r\n    // {\r\n    //   title: '征订日期',\r\n    //   dataIndex: 'solicitTime',\r\n    //   key: 'solicitTime'\r\n    // }\r\n    // {\r\n    //   title: '操作',\r\n    //   key: 'action',\r\n    //   scopedSlots: { customRender: 'action' }\r\n    // }\r\n  ]\r\n  export default {\r\n    name: 'Index',\r\n    components: {\r\n      GlobalForm\r\n    },\r\n    data () {\r\n      return {\r\n        columns,\r\n        title: '新增课程',\r\n        visibleNotice: true,\r\n        allChecked: false,\r\n        loading: false,\r\n        toPayButton: false,\r\n          message: '共购买0本书，共计0元',\r\n          spinning: true,\r\n        payType: 0, // 支付宝\r\n        payUrl: null, // 支付链接\r\n        qrCode: null, // weixin\r\n        selectRowValues: [],\r\n        selectedRowKeys: [], // 选中的table数据\r\n        editInfo: null, // 需要编辑的该条数据的信息\r\n        visible: false,\r\n        data: [\r\n        //         {\r\n        //   id: 1,\r\n        //   payPrice: '123',\r\n        //   courseName: '大学物理',\r\n        //   bookName: '大学物理',\r\n        //   studentName: '张三',\r\n        //   studentNum: '089789',\r\n        //   className: '01班',\r\n        //   solicitTime: '2019-09-12 12:00'\r\n        // }, {\r\n        //   id: 2,\r\n        //   payPrice: '123',\r\n        //   courseName: '大学物理',\r\n        //   bookName: '大学物理',\r\n        //   studentName: '李四',\r\n        //   studentNum: '089789',\r\n        //   className: '02班',\r\n        //   solicitTime: '2019-09-12 12:00'\r\n        // }\r\n        ],\r\n        pagination: {// 分页\r\n          current: 1,\r\n          pageSize: 20,\r\n          total: 0\r\n        }\r\n      }\r\n    },\r\n    computed: {\r\n      getFormData () {\r\n        return formData.getFormData(this)\r\n      }\r\n    },\r\n    created () {\r\n      // this.$store.dispatch('GetSchool')\r\n    },\r\n    mounted () {\r\n      const userInfo = this.$store.getters.userInfo || {}\r\n      services.getStudent({ schoolId: userInfo.schoolId, id: userInfo.id }).then(response => {\r\n        this.data = this.checkData(response.subscriptionsDetailList || [])\r\n                  if (this.data.filter(item => item.checked).length === this.data.length) {\r\n                    this.allChecked = true\r\n                  }\r\n                  this.checkToPay(this.data)\r\n        this.setSelectKeys(response.subscriptionsDetailList || [])\r\n              })\r\n    },\r\n    methods: {\r\n      // 分页切换\r\n      changePage (pagination) {\r\n        this.pagination.current = pagination.current\r\n        this.getStudent({ pageIndex: pagination.current, pageSize: this.pagination.pageSize, ...this.searchData })\r\n      },\r\n      search () { // 查询\r\n        const params = this.$refs.schoolSerch.getFieldsValue()\r\n        this.searchData = { ...params, schoolId: this.$store.getters.selectSchoolInfo.value || '' }\r\n        this.pagination.current = 1\r\n        this.getStudent({ pageIndex: 1, pageSize: this.pagination.pageSize, ...this.searchData })\r\n      },\r\n      reset () { // 重置\r\n        this.$refs.schoolSerch.resetFields()\r\n        // this.searchData = { schoolId: this.$store.getters.schoolNameList[0] ? this.$store.getters.schoolNameList[0].value : '' }// 查询数据\r\n      },\r\n      onSelectChange (selectedRowKeys, value) { // table选择\r\n        console.log('selectedRowKeys changed: ', selectedRowKeys, value)\r\n        this.selectRowValues = value\r\n        this.selectedRowKeys = selectedRowKeys\r\n      },\r\n      onShow (data) { // 查看已付款学生信息详情\r\n        this.$router.push({ path: '/book/solicitManage/unPayedInfo', query: { id: data.id } })\r\n      },\r\n      getStudent (data) {\r\n        this.loading = true\r\n        services.getStudent({ ...data, isPayment: 0 }).then(response => {\r\n          this.data = response.records || []\r\n          this.pagination.total = response.total || 0\r\n          this.loading = false\r\n        })\r\n      },\r\n      checkData (bookData) {\r\n        return bookData.map(item => {\r\n          return {\r\n            ...item,\r\n            checked: item.must === 1\r\n          }\r\n        })\r\n      },\r\n        setSelectKeys (data) {\r\n            for (let i = 0; i < data.length; i++) {\r\n                if (data[i].must) {\r\n                    this.selectRowValues.push(data[i])\r\n                    this.selectedRowKeys.push(data[i].teachingMaterialId)\r\n                }\r\n            }\r\n        },\r\n      toPayAsPC () {\r\n        const userInfo = this.$store.getters.userInfo || {}\r\n          // this.payUrl = null// 默认支付宝方式\r\n          this.spinning = true\r\n        let newData = this._.cloneDeep(this.data)\r\n         newData = newData.filter(item => item.checked).map(item => {\r\n          delete item.checked\r\n          return {\r\n          ...item\r\n        }\r\n})\r\n        services.toPayAsPC({ schoolId: userInfo.schoolId,\r\n          studentId: userInfo.id,\r\n          studentNum: userInfo.studentNum,\r\n          subscriptionsDetailList: newData }).then(response => {\r\n          // this.qrCode = null\r\n          // this.payUrl = response// 默认支付宝方式\r\n          this.qrCode = response.payUrl\r\n            this.message = `共购买${response.bookCount}本书，共计${response.totalPrice}元`\r\n          this.$nextTick(() => {\r\n            document.getElementById('qrcode').innerHTML = ''\r\n            const qrcode = new QRCode(this.$refs.qrcode, {\r\n              width: 200,\r\n              height: 200 // 高度\r\n            })\r\n              this.spinning = false\r\n            qrcode.makeCode(response.payUrl)\r\n          })\r\n          // window.open(response)\r\n        })\r\n      }, // 支付宝接口\r\n      wxPay () { // 微信接口\r\n        const userInfo = this.$store.getters.userInfo || {}\r\n          this.spinning = true\r\n        let newData = this._.cloneDeep(this.data)\r\n         newData = newData.filter(item => item.checked).map(item => {\r\n          delete item.checked\r\n          return {\r\n            ...item\r\n          }\r\n        })\r\n          services.wxPay({ schoolId: userInfo.schoolId,\r\n          studentId: userInfo.id,\r\n          studentNum: userInfo.studentNum,\r\n          subscriptionsDetailList: newData }).then(response => {\r\n              this.qrCode = response.payUrl\r\n              this.message = `共购买${response.bookCount}本书，共计${response.totalPrice}元`\r\n          this.$nextTick(() => {\r\n            document.getElementById('qrcode').innerHTML = ''\r\n            const qrcode = new QRCode(this.$refs.qrcode, {\r\n              width: 200,\r\n              height: 200 // 高度\r\n            })\r\n              this.spinning = false\r\n              qrcode.makeCode(response.payUrl)\r\n            // this.payUrl = null// 默认支付宝方式\r\n          })\r\n        })\r\n      }, // 支付宝接口\r\n      submitPay () {\r\n        // if (this.selectRowValues && this.selectRowValues.length > 0) {\r\n          this.payType = 0\r\n          this.visible = true\r\n          this.toPayAsPC()\r\n        // }\r\n      },\r\n      payTypeFun (type) { // 切换支付方式\r\n          this.payType = type\r\n        if (type) {\r\n          // TODO 调微信接口\r\n          this.wxPay()\r\n        } else {\r\n          // TODO 调支付宝接口\r\n          this.toPayAsPC()\r\n        }\r\n      },\r\n        getCheckboxProps (record) {\r\n         return {\r\n                props: {\r\n                    disabled: record.must === 1 // Column configuration not to be checked\r\n                    // checked: record.must === 1\r\n                }\r\n                }\r\n            },\r\n      OnCancel () {\r\n        this.visible = false\r\n        const userInfo = this.$store.getters.userInfo || {}\r\n        services.getStudent({ schoolId: userInfo.schoolId, id: userInfo.id }).then(response => {\r\n          const data = response.subscriptionsDetailList || []\r\n          if (this.data.length !== data.length) {\r\n            this.data = this.checkData(response.subscriptionsDetailList || [])\r\n            if (this.data.filter(item => item.checked).length === this.data.length) {\r\n              this.allChecked = true\r\n            }\r\n            this.checkToPay(this.data)\r\n          }\r\n        })\r\n      },\r\n      selectAll (e) {\r\n        if (e.target.checked) {\r\n          this.allChecked = true\r\n          this.data = this.data.map(item => {\r\n            return {\r\n              ...item,\r\n              checked: true\r\n            }\r\n          })\r\n        } else {\r\n          this.allChecked = false\r\n          this.data = this.checkData(this.data)\r\n        }\r\n        this.checkToPay(this.data)\r\n      },\r\n      checkToPay (data) {\r\n        if (data.filter(item => item.checked).length > 0) {\r\n          this.toPayButton = true\r\n        } else {\r\n          this.toPayButton = false\r\n        }\r\n      },\r\n      selectBook (e, id) {\r\n        this.data = this.data.map(item => {\r\n          if (item.teachingMaterialId === id) {\r\n            return {\r\n              ...item,\r\n              checked: e.target.checked\r\n            }\r\n          }\r\n          return {\r\n            ...item\r\n          }\r\n        })\r\n        if (this.data.filter(item => item.checked).length === this.data.length) {\r\n          this.allChecked = true\r\n        } else {\r\n          this.allChecked = false\r\n        }\r\n        this.checkToPay(this.data)\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  @import \"../style.less\";\r\n  .payDom {\r\n    .content {\r\n      background: #fff;\r\n      position: absolute;\r\n      top: 70px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      /*padding:60px 10px 10px 10px;*/\r\n      border-radius: 2px;\r\n      /*display: flex;*/\r\n      /*  justify-content: center;*/\r\n      /*flex-flow:nowrap;*/\r\n      /*flex-direction:column;*/\r\n\r\n      .modal {\r\n        /deep/ .ant-modal {\r\n          width: 900px;\r\n          min-width: 900px;\r\n        }\r\n\r\n        /deep/ .ant-alert {\r\n          padding: 5px 5px 5px 15px;\r\n          font-size: 12px;\r\n\r\n          .ant-alert-icon {\r\n            top: 8px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    .pay {\r\n      .borderStyle {\r\n        border-color: #1890ff;\r\n      }\r\n      /deep/ .ant-btn {\r\n        height: auto;\r\n        padding: 10px 15px;\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]}]}