{"remainingRequest":"/Users/yushengnan/ysn/node_modules/babel-loader/lib/index.js!/Users/yushengnan/ysn/node_modules/eslint-loader/index.js??ref--13-0!/Users/yushengnan/ysn/src/store/modules/permission.js","dependencies":[{"path":"/Users/yushengnan/ysn/src/store/modules/permission.js","mtime":1611887314110},{"path":"/Users/yushengnan/ysn/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IHsgYXN5bmNSb3V0ZXJNYXAsIGNvbnN0YW50Um91dGVyTWFwLCBhc3luY1N0dWRlbnRSb3V0ZXJNYXAgfSBmcm9tICdAL2NvbmZpZy9yb3V0ZXIuY29uZmlnJzsKaW1wb3J0IGxvZGFzaCBmcm9tICdsb2Rhc2gnOwovKioKICog6L+H5ruk6LSm5oi35piv5ZCm5oul5pyJ5p+Q5LiA5Liq5p2D6ZmQ77yM5bm25bCG6I+c5Y2V5LuO5Yqg6L295YiX6KGo56e76ZmkCiAqCiAqIEBwYXJhbSBwZXJtaXNzaW9uCiAqIEBwYXJhbSByb3V0ZQogKiBAcmV0dXJucyB7Ym9vbGVhbn0KICovCgpmdW5jdGlvbiBoYXNQZXJtaXNzaW9uKHBlcm1pc3Npb24sIHJvdXRlKSB7CiAgaWYgKHJvdXRlLm1ldGEgJiYgcm91dGUubWV0YS5wZXJtaXNzaW9uKSB7CiAgICB2YXIgZmxhZyA9IGZhbHNlOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwZXJtaXNzaW9uLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIC8vIOWQjuacn+WPr+S7peS/ruaUue+8jOWmguaenOS4gOS4queUqOaIt+WkmuS4quinkuiJsgogICAgICBmbGFnID0gcm91dGUubWV0YS5wZXJtaXNzaW9uLmluY2x1ZGVzKHBlcm1pc3Npb25baV0pOwoKICAgICAgaWYgKGZsYWcpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiB0cnVlOwp9Ci8qKgogKiDljZXotKbmiLflpJrop5LoibLml7bvvIzkvb/nlKjor6Xmlrnms5Xlj6/ov4fmu6Top5LoibLkuI3lrZjlnKjnmoToj5zljZUKICoKICogQHBhcmFtIHJvbGVzCiAqIEBwYXJhbSByb3V0ZQogKiBAcmV0dXJucyB7Kn0KICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQoKCmZ1bmN0aW9uIGhhc1JvbGUocm9sZXMsIHJvdXRlKSB7CiAgaWYgKHJvdXRlLm1ldGEgJiYgcm91dGUubWV0YS5yb2xlcykgewogICAgcmV0dXJuIHJvdXRlLm1ldGEucm9sZXMuaW5jbHVkZXMocm9sZXMuaWQpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmZ1bmN0aW9uIGZpbHRlckFzeW5jUm91dGVyKHJvdXRlck1hcCwgcm9sZXMpIHsKICB2YXIgYWNjZXNzZWRSb3V0ZXJzID0gcm91dGVyTWFwLmZpbHRlcihmdW5jdGlvbiAocm91dGUpIHsKICAgIGlmIChoYXNQZXJtaXNzaW9uKHJvbGVzLCByb3V0ZSkpIHsKICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIHJvdXRlLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHJvdXRlLmNoaWxkcmVuID0gZmlsdGVyQXN5bmNSb3V0ZXIocm91dGUuY2hpbGRyZW4sIHJvbGVzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0pOwogIHJldHVybiBhY2Nlc3NlZFJvdXRlcnM7Cn0KCnZhciBwZXJtaXNzaW9uID0gewogIHN0YXRlOiB7CiAgICByb3V0ZXJzOiBjb25zdGFudFJvdXRlck1hcCwKICAgIGFkZFJvdXRlcnM6IFtdCiAgfSwKICBtdXRhdGlvbnM6IHsKICAgIFNFVF9ST1VURVJTOiBmdW5jdGlvbiBTRVRfUk9VVEVSUyhzdGF0ZSwgcm91dGVycykgewogICAgICBzdGF0ZS5hZGRSb3V0ZXJzID0gcm91dGVyczsKICAgICAgc3RhdGUucm91dGVycyA9IGNvbnN0YW50Um91dGVyTWFwLmNvbmNhdChyb3V0ZXJzKTsKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIEdlbmVyYXRlUm91dGVzOiBmdW5jdGlvbiBHZW5lcmF0ZVJvdXRlcyhfcmVmLCBkYXRhKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIHJvbGVzID0gZGF0YS5yb2xlcywKICAgICAgICAgICAgdXNlciA9IGRhdGEudXNlcjsKICAgICAgICB2YXIgcm91dGVzID0gbG9kYXNoLmNsb25lRGVlcChhc3luY1JvdXRlck1hcCk7CgogICAgICAgIGlmICh1c2VyLnVzZXJUeXBlICYmIHVzZXIudXNlclR5cGUgPT09ICdzY2hvb2wnKSB7CiAgICAgICAgICByb3V0ZXMgPSBsb2Rhc2guY2xvbmVEZWVwKGFzeW5jUm91dGVyTWFwKTsKICAgICAgICB9IGVsc2UgaWYgKHVzZXIudXNlclR5cGUgJiYgdXNlci51c2VyVHlwZSA9PT0gJ3N0dWRlbnQnKSB7CiAgICAgICAgICByb3V0ZXMgPSBsb2Rhc2guY2xvbmVEZWVwKGFzeW5jU3R1ZGVudFJvdXRlck1hcCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgYWNjZXNzZWRSb3V0ZXJzID0gZmlsdGVyQXN5bmNSb3V0ZXIocm91dGVzLCByb2xlcyk7CiAgICAgICAgY29tbWl0KCdTRVRfUk9VVEVSUycsIGFjY2Vzc2VkUm91dGVycyk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0KICB9Cn07CmV4cG9ydCBkZWZhdWx0IHBlcm1pc3Npb247"},{"version":3,"sources":["/Users/yushengnan/ysn/src/store/modules/permission.js"],"names":["asyncRouterMap","constantRouterMap","asyncStudentRouterMap","lodash","hasPermission","permission","route","meta","flag","i","len","length","includes","hasRole","roles","id","filterAsyncRouter","routerMap","accessedRouters","filter","children","state","routers","addRouters","mutations","SET_ROUTERS","concat","actions","GenerateRoutes","data","commit","Promise","resolve","user","routes","cloneDeep","userType"],"mappings":";;;;;AAAA,SAASA,cAAT,EAAyBC,iBAAzB,EAA4CC,qBAA5C,QAAyE,wBAAzE;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,aAAT,CAAwBC,UAAxB,EAAoCC,KAApC,EAA2C;AACzC,MAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWF,UAA7B,EAAyC;AACvC,QAAIG,IAAI,GAAG,KAAX;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGL,UAAU,CAACM,MAAjC,EAAyCF,CAAC,GAAGC,GAA7C,EAAkDD,CAAC,EAAnD,EAAuD;AAAE;AACvDD,MAAAA,IAAI,GAAGF,KAAK,CAACC,IAAN,CAAWF,UAAX,CAAsBO,QAAtB,CAA+BP,UAAU,CAACI,CAAD,CAAzC,CAAP;;AACA,UAAID,IAAJ,EAAU;AACR,eAAO,IAAP;AACD;AACF;;AACD,WAAO,KAAP;AACD;;AACD,SAAO,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASK,OAAT,CAAiBC,KAAjB,EAAwBR,KAAxB,EAA+B;AAC7B,MAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWO,KAA7B,EAAoC;AAClC,WAAOR,KAAK,CAACC,IAAN,CAAWO,KAAX,CAAiBF,QAAjB,CAA0BE,KAAK,CAACC,EAAhC,CAAP;AACD,GAFD,MAEO;AACL,WAAO,IAAP;AACD;AACF;;AAED,SAASC,iBAAT,CAA4BC,SAA5B,EAAuCH,KAAvC,EAA8C;AAC5C,MAAMI,eAAe,GAAGD,SAAS,CAACE,MAAV,CAAiB,UAAAb,KAAK,EAAI;AAChD,QAAIF,aAAa,CAACU,KAAD,EAAQR,KAAR,CAAjB,EAAiC;AAC/B,UAAIA,KAAK,CAACc,QAAN,IAAkBd,KAAK,CAACc,QAAN,CAAeT,MAArC,EAA6C;AAC3CL,QAAAA,KAAK,CAACc,QAAN,GAAiBJ,iBAAiB,CAACV,KAAK,CAACc,QAAP,EAAiBN,KAAjB,CAAlC;AACD;;AACD,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD,GARuB,CAAxB;AASA,SAAOI,eAAP;AACD;;AAED,IAAMb,UAAU,GAAG;AACjBgB,EAAAA,KAAK,EAAE;AACLC,IAAAA,OAAO,EAAErB,iBADJ;AAELsB,IAAAA,UAAU,EAAE;AAFP,GADU;AAKjBC,EAAAA,SAAS,EAAE;AACTC,IAAAA,WAAW,EAAE,qBAACJ,KAAD,EAAQC,OAAR,EAAoB;AAC/BD,MAAAA,KAAK,CAACE,UAAN,GAAmBD,OAAnB;AACAD,MAAAA,KAAK,CAACC,OAAN,GAAgBrB,iBAAiB,CAACyB,MAAlB,CAAyBJ,OAAzB,CAAhB;AACD;AAJQ,GALM;AAWjBK,EAAAA,OAAO,EAAE;AACPC,IAAAA,cADO,gCACqBC,IADrB,EAC2B;AAAA,UAAhBC,MAAgB,QAAhBA,MAAgB;AAChC,aAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAAA,YACpBlB,KADoB,GACJe,IADI,CACpBf,KADoB;AAAA,YACbmB,IADa,GACJJ,IADI,CACbI,IADa;AAE5B,YAAIC,MAAM,GAAG/B,MAAM,CAACgC,SAAP,CAAiBnC,cAAjB,CAAb;;AACA,YAAIiC,IAAI,CAACG,QAAL,IAAiBH,IAAI,CAACG,QAAL,KAAkB,QAAvC,EAAiD;AAC9CF,UAAAA,MAAM,GAAG/B,MAAM,CAACgC,SAAP,CAAiBnC,cAAjB,CAAT;AACF,SAFD,MAEO,IAAIiC,IAAI,CAACG,QAAL,IAAiBH,IAAI,CAACG,QAAL,KAAkB,SAAvC,EAAkD;AACvDF,UAAAA,MAAM,GAAG/B,MAAM,CAACgC,SAAP,CAAiBjC,qBAAjB,CAAT;AACD;;AACD,YAAMgB,eAAe,GAAGF,iBAAiB,CAACkB,MAAD,EAASpB,KAAT,CAAzC;AACAgB,QAAAA,MAAM,CAAC,aAAD,EAAgBZ,eAAhB,CAAN;AACAc,QAAAA,OAAO;AACR,OAXM,CAAP;AAYD;AAdM;AAXQ,CAAnB;AA6BA,eAAe3B,UAAf","sourcesContent":["import { asyncRouterMap, constantRouterMap, asyncStudentRouterMap } from '@/config/router.config'\nimport lodash from 'lodash'\n\n/**\n * 过滤账户是否拥有某一个权限，并将菜单从加载列表移除\n *\n * @param permission\n * @param route\n * @returns {boolean}\n */\nfunction hasPermission (permission, route) {\n  if (route.meta && route.meta.permission) {\n    let flag = false\n    for (let i = 0, len = permission.length; i < len; i++) { // 后期可以修改，如果一个用户多个角色\n      flag = route.meta.permission.includes(permission[i])\n      if (flag) {\n        return true\n      }\n    }\n    return false\n  }\n  return true\n}\n\n/**\n * 单账户多角色时，使用该方法可过滤角色不存在的菜单\n *\n * @param roles\n * @param route\n * @returns {*}\n */\n// eslint-disable-next-line\nfunction hasRole(roles, route) {\n  if (route.meta && route.meta.roles) {\n    return route.meta.roles.includes(roles.id)\n  } else {\n    return true\n  }\n}\n\nfunction filterAsyncRouter (routerMap, roles) {\n  const accessedRouters = routerMap.filter(route => {\n    if (hasPermission(roles, route)) {\n      if (route.children && route.children.length) {\n        route.children = filterAsyncRouter(route.children, roles)\n      }\n      return true\n    }\n    return false\n  })\n  return accessedRouters\n}\n\nconst permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: (state, routers) => {\n      state.addRouters = routers\n      state.routers = constantRouterMap.concat(routers)\n    }\n  },\n  actions: {\n    GenerateRoutes ({ commit }, data) {\n      return new Promise(resolve => {\n        const { roles, user } = data\n        let routes = lodash.cloneDeep(asyncRouterMap)\n        if (user.userType && user.userType === 'school') {\n           routes = lodash.cloneDeep(asyncRouterMap)\n        } else if (user.userType && user.userType === 'student') {\n          routes = lodash.cloneDeep(asyncStudentRouterMap)\n        }\n        const accessedRouters = filterAsyncRouter(routes, roles)\n        commit('SET_ROUTERS', accessedRouters)\n        resolve()\n      })\n    }\n  }\n}\n\nexport default permission\n"]}]}