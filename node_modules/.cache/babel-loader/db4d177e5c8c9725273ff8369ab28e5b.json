{"remainingRequest":"/Users/yushengnan/ysn/node_modules/babel-loader/lib/index.js!/Users/yushengnan/ysn/node_modules/eslint-loader/index.js??ref--13-0!/Users/yushengnan/ysn/src/permission.js","dependencies":[{"path":"/Users/yushengnan/ysn/src/permission.js","mtime":1617857316701},{"path":"/Users/yushengnan/ysn/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yushengnan/ysn/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIi9Vc2Vycy95dXNoZW5nbmFuL3lzbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCByb3V0ZXIgZnJvbSAnLi9yb3V0ZXInOwppbXBvcnQgc3RvcmUgZnJvbSAnLi9zdG9yZSc7CmltcG9ydCBOUHJvZ3Jlc3MgZnJvbSAnbnByb2dyZXNzJzsgLy8gcHJvZ3Jlc3MgYmFyCgppbXBvcnQgJ0AvY29tcG9uZW50cy9OUHJvZ3Jlc3MvbnByb2dyZXNzLmxlc3MnOyAvLyBwcm9ncmVzcyBiYXIgY3VzdG9tIHN0eWxlCgppbXBvcnQgeyBzZXREb2N1bWVudFRpdGxlLCBkb21UaXRsZSB9IGZyb20gJ0AvdXRpbHMvZG9tVXRpbCc7CmltcG9ydCB7IGkxOG5SZW5kZXIgfSBmcm9tICdAL2xvY2FsZXMnOwppbXBvcnQgeyBMU3RvcmFnZSB9IGZyb20gJ0Avc3RvcmUvc2Vzc2lvbi5qcyc7Ck5Qcm9ncmVzcy5jb25maWd1cmUoewogIHNob3dTcGlubmVyOiBmYWxzZQp9KTsgLy8gTlByb2dyZXNzIENvbmZpZ3VyYXRpb24KCnZhciB3aGl0ZUxpc3QgPSBbJ2xvZ2luJywgJ3N0dWRlbnRMb2dpbiddOyAvLyBubyByZWRpcmVjdCB3aGl0ZWxpc3QKCnZhciBsb2dpblJvdXRlUGF0aCA9ICcvdXNlci9sb2dpbic7CnZhciBkZWZhdWx0Um91dGVQYXRoID0gJy9ib29rL3NvbGljaXRNYW5hZ2UvY291cnNlTWFuYWdlJzsKcm91dGVyLmJlZm9yZUVhY2goZnVuY3Rpb24gKHRvLCBmcm9tLCBuZXh0KSB7CiAgTlByb2dyZXNzLnN0YXJ0KCk7IC8vIHN0YXJ0IHByb2dyZXNzIGJhcgoKICB0by5tZXRhICYmIHR5cGVvZiB0by5tZXRhLnRpdGxlICE9PSAndW5kZWZpbmVkJyAmJiBzZXREb2N1bWVudFRpdGxlKCIiLmNvbmNhdChpMThuUmVuZGVyKHRvLm1ldGEudGl0bGUpLCAiIC0gIikuY29uY2F0KGRvbVRpdGxlKSk7CiAgLyogaGFzIHRva2VuICovCgogIGlmIChMU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpKSB7CiAgICBpZiAodG8ucGF0aCA9PT0gbG9naW5Sb3V0ZVBhdGgpIHsKICAgICAgbmV4dCh7CiAgICAgICAgcGF0aDogZGVmYXVsdFJvdXRlUGF0aAogICAgICB9KTsKICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghc3RvcmUuZ2V0dGVycy5uaWNrbmFtZSkgewogICAgICAgIC8vIOW9k+mhtemdouWIt+aWsOaXtgogICAgICAgIHN0b3JlLmRpc3BhdGNoKCdHZXRJbmZvJykudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgnR2V0U2Nob29sJykudGhlbigpWyJjYXRjaCJdKClbImZpbmFsbHkiXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdHZXRDbGFzcycpOwogICAgICAgICAgICB2YXIgcGVybWlzc2lvbiA9IFtdOwogICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgnR2VuZXJhdGVSb3V0ZXMnLCB7CiAgICAgICAgICAgICAgcm9sZXM6IHBlcm1pc3Npb24sCiAgICAgICAgICAgICAgdXNlcjogcmVzLnVzZXIgfHwge30KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8g5YaZ5q276KeS6Imy77yM5a6e6ZmF5bqU6K+l5qC55o2u5ZCO5Y+w5Lyg6L+H5p2l55qE6KeS6Imy5L+h5oGvCiAgICAgICAgICAgICAgLy8g5qC55o2ucm9sZXPmnYPpmZDnlJ/miJDlj6/orr/pl67nmoTot6/nlLHooagKICAgICAgICAgICAgICAvLyDliqjmgIHmt7vliqDlj6/orr/pl67ot6/nlLHooagKICAgICAgICAgICAgICByb3V0ZXIuYWRkUm91dGVzKHN0b3JlLmdldHRlcnMuYWRkUm91dGVycyk7IC8vIOivt+axguW4puaciSByZWRpcmVjdCDph43lrprlkJHml7bvvIznmbvlvZXoh6rliqjph43lrprlkJHliLDor6XlnLDlnYAKCiAgICAgICAgICAgICAgdmFyIHJlZGlyZWN0ID0gZGVjb2RlVVJJQ29tcG9uZW50KGZyb20ucXVlcnkucmVkaXJlY3QgfHwgdG8ucGF0aCk7CgogICAgICAgICAgICAgIGlmICh0by5wYXRoID09PSByZWRpcmVjdCkgewogICAgICAgICAgICAgICAgbmV4dChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDot7PovazliLDnm67nmoTot6/nlLEKICAgICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAgICBwYXRoOiByZWRpcmVjdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIOWksei0peaXtu+8jOiOt+WPlueUqOaIt+S/oeaBr+Wksei0peaXtu+8jOiwg+eUqOeZu+WHuu+8jOadpea4heepuuWOhuWPsuS/neeVmeS/oeaBrwogICAgICAgICAgLy8gaWYgKHN0b3JlLmdldHRlcnMudXNlckluZm8udXNlclR5cGU/LnVzZXJUeXBlID09PSAnc3R1ZGVudCcpIHsKICAgICAgICAgIC8vICAgc3RvcmUuZGlzcGF0Y2goJ09uQ2xlYXInKS50aGVuKCgpID0+IHsKICAgICAgICAgIC8vICAgICBuZXh0KHsgcGF0aDogJy9zdHVkZW50JywgcXVlcnk6IHsgcmVkaXJlY3Q6IHRvLmZ1bGxQYXRoIH0gfSkKICAgICAgICAgIC8vICAgfSkKICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgnT25DbGVhcicpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICBwYXRoOiBsb2dpblJvdXRlUGF0aCwKICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgcmVkaXJlY3Q6IHRvLmZ1bGxQYXRoCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOyAvLyB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5b2T6aG16Z2i5rKh5pyJ5Yi35paw5pe2CiAgICAgICAgbmV4dCgpOwogICAgICB9CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmICh3aGl0ZUxpc3QuaW5jbHVkZXModG8ubmFtZSkpIHsKICAgICAgLy8g5Zyo5YWN55m75b2V55m95ZCN5Y2V77yM55u05o6l6L+b5YWlCiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoewogICAgICAgIHBhdGg6IGxvZ2luUm91dGVQYXRoLAogICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICByZWRpcmVjdDogdG8uZnVsbFBhdGgKICAgICAgICB9CiAgICAgIH0pOwogICAgICBOUHJvZ3Jlc3MuZG9uZSgpOyAvLyBpZiBjdXJyZW50IHBhZ2UgaXMgbG9naW4gd2lsbCBub3QgdHJpZ2dlciBhZnRlckVhY2ggaG9vaywgc28gbWFudWFsbHkgaGFuZGxlIGl0CiAgICB9CiAgfQp9KTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogIE5Qcm9ncmVzcy5kb25lKCk7IC8vIGZpbmlzaCBwcm9ncmVzcyBiYXIKfSk7"},{"version":3,"sources":["/Users/yushengnan/ysn/src/permission.js"],"names":["router","store","NProgress","setDocumentTitle","domTitle","i18nRender","LStorage","configure","showSpinner","whiteList","loginRoutePath","defaultRoutePath","beforeEach","to","from","next","start","meta","title","getItem","path","done","getters","nickname","dispatch","then","res","permission","roles","user","addRoutes","addRouters","redirect","decodeURIComponent","query","replace","fullPath","includes","name","afterEach","window","scrollTo"],"mappings":"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","sourcesContent":["import router from './router'\nimport store from './store'\nimport NProgress from 'nprogress' // progress bar\nimport '@/components/NProgress/nprogress.less' // progress bar custom style\nimport { setDocumentTitle, domTitle } from '@/utils/domUtil'\nimport { i18nRender } from '@/locales'\nimport { LStorage } from '@/store/session.js'\n\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\n\nconst whiteList = ['login', 'studentLogin'] // no redirect whitelist\nconst loginRoutePath = '/user/login'\nconst defaultRoutePath = '/book/solicitManage/courseManage'\n\nrouter.beforeEach((to, from, next) => {\n  NProgress.start() // start progress bar\n  to.meta && (typeof to.meta.title !== 'undefined' && setDocumentTitle(`${i18nRender(to.meta.title)} - ${domTitle}`))\n  /* has token */\n  if (LStorage.getItem('token')) {\n    if (to.path === loginRoutePath) {\n      next({ path: defaultRoutePath })\n      NProgress.done()\n    } else {\n      if (!store.getters.nickname) { // 当页面刷新时\n        store\n          .dispatch('GetInfo')\n          .then(res => {\n            store.dispatch('GetSchool').then().catch().finally(() => {\n            store.dispatch('GetClass')\n            const permission = []\n            store.dispatch('GenerateRoutes', { roles: permission, user: res.user || {} }).then(() => { // 写死角色，实际应该根据后台传过来的角色信息\n              // 根据roles权限生成可访问的路由表\n              // 动态添加可访问路由表\n              router.addRoutes(store.getters.addRouters)\n              // 请求带有 redirect 重定向时，登录自动重定向到该地址\n              const redirect = decodeURIComponent(from.query.redirect || to.path)\n              if (to.path === redirect) {\n                  next({ ...to, replace: true })\n              } else {\n                // 跳转到目的路由\n                next({ path: redirect })\n              }\n            })\n            })\n          })\n          .catch(() => {\n            // 失败时，获取用户信息失败时，调用登出，来清空历史保留信息\n            // if (store.getters.userInfo.userType?.userType === 'student') {\n            //   store.dispatch('OnClear').then(() => {\n            //     next({ path: '/student', query: { redirect: to.fullPath } })\n            //   })\n            // } else {\n              store.dispatch('OnClear').then(() => {\n                next({ path: loginRoutePath, query: { redirect: to.fullPath } })\n              })\n            // }\n          })\n      } else { // 当页面没有刷新时\n          next()\n      }\n    }\n  } else {\n    if (whiteList.includes(to.name)) {\n      // 在免登录白名单，直接进入\n      next()\n    } else {\n      next({ path: loginRoutePath, query: { redirect: to.fullPath } })\n      NProgress.done() // if current page is login will not trigger afterEach hook, so manually handle it\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  window.scrollTo(0, 0)\n  NProgress.done() // finish progress bar\n})\n"]}]}