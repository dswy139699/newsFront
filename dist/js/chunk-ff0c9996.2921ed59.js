(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ff0c9996"],{"0cb2":function(e,t,n){var i=n("7b0b"),a=Math.floor,o="".replace,r=/\$([$&'`]|\d\d?|<[^>]*>)/g,c=/\$([$&'`]|\d\d?)/g;e.exports=function(e,t,n,l,s,u){var d=n+e.length,p=l.length,f=c;return void 0!==s&&(s=i(s),f=r),o.call(u,f,(function(i,o){var r;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(d);case"<":r=s[o.slice(1,-1)];break;default:var c=+o;if(0===c)return i;if(c>p){var u=a(c/10);return 0===u?i:u<=p?void 0===l[u-1]?o.charAt(1):l[u-1]+o.charAt(1):i}r=l[c-1]}return void 0===r?"":r}))}},"4bcd":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));n("ac1f"),n("1276");function i(e){for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],n=["1","0","X","9","8","7","6","5","4","3","2"],i=e+"",a=e[17],o=i.substring(0,17),r=o.split(""),c=r.length,l=0,s=0;s<c;s++)l+=r[s]*t[s];var u=l%11,d=n[u],p=/^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/,f=p.test(e);return!(a!==d||!f)}function a(e){var t=/^0\d{2,3}-?\d{7,8}$/,n=/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;return!(!n.test(e)&&!t.test(e))}function o(e){var t=/^[a-zA-Z0-9_-]+@([a-zA-Z0-9]+\.)+(com|cn|net|org)$/;return!!t.test(e)}},5319:function(e,t,n){"use strict";var i=n("d784"),a=n("825a"),o=n("50c4"),r=n("a691"),c=n("1d80"),l=n("8aa5"),s=n("0cb2"),u=n("14c3"),d=Math.max,p=Math.min,f=function(e){return void 0===e?e:String(e)};i("replace",2,(function(e,t,n,i){var h=i.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=i.REPLACE_KEEPS_$0,m=h?"$":"$0";return[function(n,i){var a=c(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,a,i):t.call(String(a),n,i)},function(e,i){if(!h&&g||"string"===typeof i&&-1===i.indexOf(m)){var c=n(t,e,this,i);if(c.done)return c.value}var b=a(e),y=String(this),v="function"===typeof i;v||(i=String(i));var x=b.global;if(x){var S=b.unicode;b.lastIndex=0}var k=[];while(1){var C=u(b,y);if(null===C)break;if(k.push(C),!x)break;var I=String(C[0]);""===I&&(b.lastIndex=l(y,o(b.lastIndex),S))}for(var w="",$=0,D=0;D<k.length;D++){C=k[D];for(var T=String(C[0]),P=d(p(r(C.index),y.length),0),F=[],_=1;_<C.length;_++)F.push(f(C[_]));var M=C.groups;if(v){var O=[T].concat(F,P,y);void 0!==M&&O.push(M);var N=String(i.apply(void 0,O))}else N=s(T,y,P,F,M,i);P>=$&&(w+=y.slice($,P)+N,$=P+T.length)}return w+y.slice($)}]}))},"96a9":function(e,t,n){},ba63:function(e,t,n){"use strict";n("96a9")},fe78:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=this,n=t.$createElement,i=t._self._c||n;return i("page-header-wrapper",{scopedSlots:t._u([{key:"content",fn:function(){return[i("div",{staticClass:"page-header-content"})]},proxy:!0}])},[i("a-spin",{attrs:{tip:"Loading...",spinning:t.spinning}},[i("div",{staticClass:"content spin-content"},[i("div",[i("GlobalForm",{ref:"schoolSerch",attrs:{dataSource:t.getFormData,id:"schoolSearch"},scopedSlots:t._u([{key:"button",fn:function(){return[i("div",{staticStyle:{"margin-top":"4px","text-align":"right"}},[i("a-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v(" 查询 ")]),i("a-button",{staticStyle:{"margin-left":"10px"},on:{click:t.reset}},[t._v(" 重置 ")])],1)]},proxy:!0}])})],1),i("div",{staticStyle:{"text-align":"left"}},[i("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.increase}},[t._v(" 新增 ")]),i("a-upload",{attrs:{showUploadList:!1,customRequest:t.customRequest}},[i("a-button",{attrs:{type:"primary"}},[t._v(" 导入教材信息 ")])],1)],1),i("div",{staticClass:"table scroll",staticStyle:{"margin-top":"10px"}},[i("a-table",{attrs:{"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},columns:t.columns,"data-source":t.data,loading:t.loading,scroll:{x:1600},pagination:t.pagination,rowKey:function(e){return e.id}},on:{change:t.changePage},scopedSlots:t._u([{key:"price",fn:function(e,n){return i("span",{},[i("a",{on:{click:function(e){return t.openInsertNum(n)}}},[i("span",{staticStyle:{display:"inline-block",width:"60px"}},[t._v(t._s(e))])])])}},{key:"must",fn:function(e){return i("span",{},[t._v(" "+t._s(e?"是":"否")+" ")])}},{key:"offline",fn:function(e){return i("span",{},[t._v(" "+t._s(e?"是":"否")+" ")])}},{key:"action",fn:function(e,n){return i("span",{},[i("a",{on:{click:function(e){return t.onEdit(n)}}},[t._v("编辑")]),i("a-divider",{attrs:{type:"vertical"}}),i("a-popconfirm",{attrs:{title:"确定删除?","ok-text":"是","cancel-text":"否"},on:{confirm:function(e){return t.delStu(n)}}},[i("a",[t._v("删除")])])],1)}}])},[t.data&&t.data.length>0?i("template",{slot:"footer"},[i("a-button",{attrs:{type:"primary"},on:{click:t.delStus}},[t._v("删除所选数据")])],1):t._e()],2)],1),i("div",{ref:"modal",staticClass:"modal"},[i("a-modal",{attrs:{title:t.title,visible:t.visible,destroyOnClose:"",getContainer:function(){return e.$refs.modal}},on:{cancel:t.cancel,ok:t.handelOk}},[i("div",{staticClass:"increase"},[i("GlobalForm",{ref:"increaseDom",attrs:{dataSource:t.getIncreaseForm,id:"increaseDom"},scopedSlots:t._u([{key:"refundPrice",fn:function(){return[i("a-alert",{staticStyle:{margin:"5px 0 0 10px"},attrs:{message:"默认可不填，如果涉及到图书退款定价，请在这里填写，然后系统算出该退款差价。如拍后折扣实价是50元，退款定价可以设置成47元。那么退3元。",type:"warning","show-icon":""}})]},proxy:!0},{key:"refundDiscount",fn:function(){return[i("a-alert",{staticStyle:{margin:"5px 0 0 10px"},attrs:{message:" 如:0.78 如果填写了退款定价就必须填写",type:"warning","show-icon":""}})]},proxy:!0},{key:"disBuy",fn:function(){return[i("a-alert",{staticStyle:{margin:"5px 0 0 10px"},attrs:{message:"如果选择否，那么学生不可以在线征订",type:"warning","show-icon":""}})]},proxy:!0},{key:"must",fn:function(){return[i("a-alert",{staticStyle:{margin:"5px 0 0 10px"},attrs:{message:" 如果选择是，学生没有选择余地，必须要订这本书。",type:"warning","show-icon":""}})]},proxy:!0}])})],1)])],1),i("a-modal",{attrs:{title:"征订数量",visible:t.visibleNum},on:{cancel:t.cancelNum,ok:t.handleOkNum}},[i("div",{staticClass:"familyPeople"},[i("GlobalForm",{ref:"buyNumDom",attrs:{dataSource:t.formData,id:"buyNumDom"}})],1)])],1)])],1)},a=[],o=(n("ac1f"),n("5319"),n("4795"),n("ade3")),r=n("5530"),c=n("c0ad"),l=n("4360"),s={getFormData:function(e){var t=[{type:"input",label:"教材名称",col:"10",id:"name",layout:{labelCol:"100px"}},{type:"children",col:"4",name:"button"}];return t},getIncreaseForm:function(e){var t=[{type:"input",label:"教材名",col:"12",id:"name",rules:[{required:!0,message:"教材名不能为空"}],layout:{labelCol:"120px"}},{type:"input",label:"出版社名称",col:"12",id:"press",layout:{labelCol:"120px"}},{type:"select",label:"所属学校",options:l["a"].getters.schoolNameList||[],defaultValue:l["a"].getters.schoolNameList[0]?l["a"].getters.schoolNameList[0].value:"",rules:[{required:!0,message:"所属学校不能为空"}],col:"12",id:"schoolId",layout:{labelCol:"120px"}},{type:"input",label:"ISBN",col:"12",id:"isbn",layout:{labelCol:"120px"}},{type:"input",label:"版次",col:"12",id:"edition",layout:{labelCol:"120px"}},{type:"input",label:"定价",col:"12",onChange:function(t){return e.numChange(t,"price")},id:"price",layout:{labelCol:"120px"}},{type:"input",label:"折扣",col:"12",onChange:function(t){return e.numChange(t,"discount")},id:"discount",layout:{labelCol:"120px"}},{type:"input",label:"旧书折扣",col:"12",onChange:function(t){return e.numChange(t,"oldBookDiscount")},id:"oldBookDiscount",layout:{labelCol:"120px"}},{type:"input",label:"退款定价",col:"12",rules:[{required:e.refundPrice,message:"退款定价不能为空"}],onChange:function(t){return e.numChange(t,"refundPrice")},id:"refundPrice",layout:{labelCol:"120px"}},{type:"children",col:"12",name:"refundPrice"},{type:"input",label:"退款折扣",onChange:function(t){return e.numChange(t,"refundDiscount")},col:"12",id:"refundDiscount",layout:{labelCol:"120px"}},{type:"children",col:"12",name:"refundDiscount"},{type:"input",label:"获奖情况",col:"12",id:"awards",layout:{labelCol:"120px"}},{type:"input",label:"作者",col:"12",id:"author",layout:{labelCol:"120px"}},{type:"inputNumber",label:"教参数量",col:"12",id:"materialCount",min:1,layout:{labelCol:"120px"}},{type:"input",label:"回告信息",col:"12",id:"tellbackInfo",min:1,layout:{labelCol:"120px"}},{type:"textarea",label:"备注",col:"24",id:"remark",layout:{labelCol:"120px"}},{type:"switch",label:"是否可征订",defaultValue:!1,col:"5",id:"offline",layout:{labelCol:"120px"}},{type:"children",col:"16",name:"disBuy"},{type:"switch",label:"是否必须征订",defaultValue:!1,col:"5",id:"must",layout:{labelCol:"120px"}},{type:"children",col:"16",name:"must"}];return t}},u=n("4bcd"),d=(n("d3b7"),n("b067")),p={getTeachingMaterialForPage:function(e){return new Promise((function(t,n){Object(d["d"])(e).then((function(e){t(e||{})}))["catch"]((function(e){n(e)}))}))},delTeachingMaterial:function(e){return new Promise((function(t,n){Object(d["a"])(e).then((function(e){t(e)}))["catch"]((function(e){n(e)}))}))},saveTeachingMaterial:function(e){return new Promise((function(t,n){Object(d["f"])(e).then((function(e){t(e)}))["catch"]((function(e){n(e)}))}))},updateTeachingMaterial:function(e){return new Promise((function(t,n){Object(d["g"])(e).then((function(e){t(e)}))["catch"]((function(e){n(e)}))}))},getTeachingMaterialById:function(e){return new Promise((function(t,n){Object(d["c"])(e).then((function(e){t(e||{})}))["catch"]((function(e){n(e)}))}))},importTeachingMaterialInfo:function(e){return new Promise((function(t,n){Object(d["e"])(e).then((function(e){t(e)}))["catch"]((function(e){n(e)}))}))}},f=[{title:"教材名",dataIndex:"name",key:"name",width:400,ellipsis:!0,fixed:"left"},{title:"出版社",dataIndex:"press",width:200,ellipsis:!0,key:"press"},{title:"必须征订",dataIndex:"must",width:100,key:"must",scopedSlots:{customRender:"must"}},{title:"可征订",dataIndex:"offline",width:100,key:"offline",scopedSlots:{customRender:"offline"}},{title:"折扣",dataIndex:"discount",width:80,ellipsis:!0,key:"discount"},{title:"退款定价",dataIndex:"refundPrice",width:100,ellipsis:!0,key:"refundPrice"},{title:"退款折扣",dataIndex:"refundDiscount",width:100,ellipsis:!0,key:"refundDiscount"},{title:"征订数量",dataIndex:"materialCount",key:"materialCount"},{title:"定价",dataIndex:"price",width:60,ellipsis:!0,fixed:"right",scopedSlots:{customRender:"price"},key:"price"},{title:"操作",key:"action",width:120,scopedSlots:{customRender:"action"},fixed:"right"}],h={name:"Index",components:{GlobalForm:c["a"]},data:function(){return{columns:f,spinning:!1,visibleNum:!1,refundPrice:!1,title:"新增教材",loading:!0,searchData:{},selectedRowKeys:[],editInfo:null,visible:!1,formData:[{type:"input",label:"征订数量",col:"24",id:"price",buyNumId:null,onChange:this.numberChange,layout:{labelCol:"80px"}}],data:[],pagination:{current:1,pageSize:20,total:0}}},computed:{getFormData:function(){return s.getFormData(this)},getIncreaseForm:function(){return s.getIncreaseForm(this)}},created:function(){},mounted:function(){this.searchData={schoolId:this.$store.getters.selectSchoolInfo.value||""},this.getTeachingMaterialForPage(Object(r["a"])({pageIndex:1,pageSize:this.pagination.pageSize},this.searchData))},methods:{checkIdCard:function(e,t,n){if(t&&!Object(u["b"])(t)){var i="请输入正确的身份证号";n(i)}else n()},checkTel:function(e,t,n){if(t&&!Object(u["c"])(t)){var i="请输入正确格式的号码";n(i)}else n()},checkEma:function(e,t,n){if(t&&!Object(u["a"])(t)){var i="请输入正确格式的邮箱";n(i)}else n()},changePage:function(e){this.pagination.current=e.current,this.getTeachingMaterialForPage(Object(r["a"])({pageIndex:e.current,pageSize:this.pagination.pageSize},this.searchData))},increase:function(){this.title="新增教材",this.visible=!0,this.editInfo=null},onEdit:function(e){var t=this,n=this._.cloneDeep(e);this.title="编辑教材",this.editInfo=e,this.visible=!0,this.$nextTick((function(){setTimeout((function(){t.$refs.increaseDom.setFieldsValue(t._.pick(n,"name","press","schoolId","isbn","edition","price","discount","oldBookDiscount","refundPrice","refundDiscount","awards","author","materialCount","tellbackInfo","remark","offline","must")),e.refundDiscount?t.refundPrice=!0:t.refundPrice=!1}))}))},handelOk:function(){var e=this.$refs.increaseDom.handleSubmit();e&&(this.editInfo?this.updateTeachingMaterial(Object(r["a"])(Object(r["a"])({},this.editInfo),e)):this.saveTeachingMaterial(e),this.cancel())},cancel:function(){this.refundPrice=!1,this.$refs.increaseDom.resetFields(),this.visible=!1},search:function(){var e=this.$refs.schoolSerch.getFieldsValue();this.searchData=Object(r["a"])(Object(r["a"])({},e),{},{schoolId:this.$store.getters.selectSchoolInfo.value||""}),this.pagination.current=1,this.getTeachingMaterialForPage(Object(r["a"])({pageIndex:1,pageSize:this.pagination.pageSize},this.searchData))},reset:function(){this.$refs.schoolSerch.resetFields()},openInsertNum:function(e){var t=this;this.buyNumId=e.id,this.visibleNum=!0,this.$nextTick((function(){setTimeout((function(){t.$refs.buyNumDom.setFieldsValue({price:e.price})}))}))},onSelectChange:function(e){this.selectedRowKeys=e},cancelNum:function(){this.visibleNum=!1},handleOkNum:function(){for(var e={},t=this.$refs.buyNumDom.getFieldsValue().price||0,n=0;n<this.data.length;n++)if(this.buyNumId===this.data[n].id){e=this._.cloneDeep(this.data[n]),e.price=t;break}this.updateTeachingMaterial(e),this.cancelNum()},numChange:function(e,t){var n=this,i=e;i=i.replace(/[^\d.]/g,""),i=i.replace(/^\./g,""),i=i.replace(/\.{2,}/g,"."),i=i.replace(".","$#$").replace(/\./g,"").replace("$#$","."),this.$nextTick((function(){setTimeout((function(){n.$refs.increaseDom.setFieldsValue(Object(o["a"])({},t,i)),"refundDiscount"===t&&(n.refundPrice=!!i)}))}))},numberChange:function(e){var t=this,n=e;n=n.replace(/[^\d.]/g,""),n=n.replace(/^\./g,""),n=n.replace(/\.{2,}/g,"."),n=n.replace(".","$#$").replace(/\./g,"").replace("$#$","."),this.$nextTick((function(){setTimeout((function(){t.$refs.buyNumDom.setFieldsValue({price:n})}))}))},getTeachingMaterialForPage:function(e){var t=this;this.loading=!0,p.getTeachingMaterialForPage(e).then((function(e){t.data=e.records||[],t.pagination.total=e.total||0,t.loading=!1}))},saveTeachingMaterial:function(e){var t=this;p.saveTeachingMaterial(e).then((function(e){t.$notification.success({message:"新增成功"}),t.getTeachingMaterialForPage(Object(r["a"])({pageIndex:t.pagination.current,pageSize:t.pagination.pageSize},t.searchData))}))},updateTeachingMaterial:function(e){var t=this;p.updateTeachingMaterial(e).then((function(e){t.$notification.success({message:"更新成功"}),t.getTeachingMaterialForPage(Object(r["a"])({pageIndex:t.pagination.current,pageSize:t.pagination.pageSize},t.searchData))}))},delStu:function(e){this.delTeachingMaterial({idList:[e.id]})},delStus:function(){this.delTeachingMaterial({idList:this.selectedRowKeys})},delTeachingMaterial:function(e){var t=this;p.delTeachingMaterial(e).then((function(e){t.$notification.success({message:"删除成功"}),t.getTeachingMaterialForPage(Object(r["a"])({pageIndex:t.pagination.current,pageSize:t.pagination.pageSize},t.searchData))}))},customRequest:function(e){var t=this,n=this.$store.getters.selectSchoolInfo||{};if(!n.value)return this.$notification.error({message:"学校信息不能为空",description:"请在右上角选择学校之后再上传"}),!0;this.spinning=!0;var i=new FormData;i.append("files",e.file),i.append("schoolId",n.value),i.append("importType",n.importType),p.importTeachingMaterialInfo(i).then((function(e){t.$notification.success({message:"文件上传成功"}),t.spinning=!1,t.files=e}))["catch"]((function(){t.spinning=!1}))}}},g=h,m=(n("ba63"),n("2877")),b=Object(m["a"])(g,i,a,!1,null,"d209313e",null);t["default"]=b.exports}}]);