(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3514f655"],{"4bcd":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));n("ac1f"),n("1276");function a(t){for(var e=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],n=["1","0","X","9","8","7","6","5","4","3","2"],a=t+"",o=t[17],i=a.substring(0,17),s=i.split(""),c=s.length,l=0,u=0;u<c;u++)l+=s[u]*e[u];var r=l%11,d=n[r],p=/^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/,f=p.test(t);return!(o!==d||!f)}function o(t){var e=/^0\d{2,3}-?\d{7,8}$/,n=/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;return!(!n.test(t)&&!e.test(t))}function i(t){var e=/^[a-zA-Z0-9_-]+@([a-zA-Z0-9]+\.)+(com|cn|net|org)$/;return!!e.test(t)}},"8ecc":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=this,n=e.$createElement,a=e._self._c||n;return a("page-header-wrapper",{scopedSlots:e._u([{key:"content",fn:function(){return[a("div",{staticClass:"page-header-content"})]},proxy:!0}])},[a("a-spin",{attrs:{tip:"Loading...",spinning:e.spinning}},[a("div",{staticClass:"content spin-content"},[a("div",[a("GlobalForm",{ref:"schoolSerch",attrs:{dataSource:e.getFormData,id:"schoolSearch"},scopedSlots:e._u([{key:"button",fn:function(){return[a("div",{staticStyle:{"margin-top":"4px","text-align":"right"}},[a("a-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v(" 查询 ")]),a("a-button",{staticStyle:{"margin-left":"10px"},on:{click:e.reset}},[e._v(" 重置 ")])],1)]},proxy:!0}])})],1),a("div",{staticStyle:{"text-align":"left"}},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.increase}},[e._v(" 新增 ")]),a("a-upload",{staticStyle:{"margin-right":"10px"},attrs:{showUploadList:!1,customRequest:e.customRequest}},[a("a-button",{attrs:{type:"primary"}},[e._v(" 导入学生信息 ")])],1),a("a-upload",{attrs:{showUploadList:!1,customRequest:e.customRequestBook}},[a("a-button",{attrs:{type:"primary"}},[e._v(" 导入学生教材信息 ")])],1)],1),a("div",{staticClass:"table",staticStyle:{"margin-top":"10px"}},[a("a-table",{attrs:{"row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.data,loading:e.loading,pagination:e.pagination,rowKey:function(t){return t.id}},on:{change:e.changePage},scopedSlots:e._u([{key:"action",fn:function(t,n){return a("span",{},[a("a",{on:{click:function(t){return e.onEdit(n)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-popconfirm",{attrs:{title:"确定删除?","ok-text":"是","cancel-text":"否"},on:{confirm:function(t){return e.delStu(n)}}},[a("a",[e._v("删除")])])],1)}}])},[e.data&&e.data.length>0?a("template",{slot:"footer"},[a("a-button",{attrs:{type:"primary"},on:{click:e.delStus}},[e._v("删除所选数据")])],1):e._e()],2)],1),a("div",{staticClass:"modal"},[a("a-modal",{attrs:{title:"信息确认",visible:e.visibleInfo,footer:null},on:{cancel:function(t){e.visibleInfo=!1}}},[a("div",{staticClass:"increase"},[a("GlobalForm",{ref:"information",attrs:{dataSource:e.getInfoData,id:"information"},scopedSlots:e._u([{key:"button",fn:function(){return[a("div",{staticStyle:{"margin-top":"10px","padding-top":"20px","text-align":"right"}},[a("a-button",{staticStyle:{"margin-right":"10px"},on:{click:function(t){e.visibleInfo=!1}}},[e._v("取消")]),a("a-upload",{attrs:{showUploadList:!1,customRequest:e.customRequestBook}},[a("a-button",{attrs:{type:"primary"}},[e._v("确定")])],1)],1)]},proxy:!0}])})],1)])],1),a("div",{ref:"modal",staticClass:"modal"},[a("a-modal",{attrs:{title:e.title,visible:e.visible,destroyOnClose:"",getContainer:function(){return t.$refs.modal}},on:{cancel:e.cancel,ok:e.handelOk}},[a("div",{staticClass:"increase"},[a("GlobalForm",{ref:"increaseDom",attrs:{dataSource:e.getIncreaseForm,id:"increaseDom"}})],1)])],1)])])],1)},o=[],i=(n("4795"),n("5530")),s=n("c0ad"),c=n("4360"),l={getFormData:function(t){var e=[{type:"input",label:"班级名称",col:"6",id:"clazzName",layout:{labelCol:"100px"}},{type:"input",label:"学生姓名",col:"6",id:"name",layout:{labelCol:"100px"}},{type:"input",label:"学号",col:"6",id:"studentNum",layout:{labelCol:"100px"}},{type:"children",col:"6",name:"button"}];return e},getIncreaseForm:function(t){var e=[{type:"input",label:"姓名",col:"12",id:"name",rules:[{required:!0,message:"姓名不能为空"}],layout:{labelCol:"120px"}},{type:"input",label:"学号",col:"12",rules:[{required:!0,message:"学号不能为空"}],id:"studentNum",layout:{labelCol:"120px"}},{type:"inputNumber",label:"学制",min:1,col:"12",id:"educationalSys",layout:{labelCol:"120px"}},{type:"datePicker",label:"入学年月",format:"YYYY-MM-DD",col:"12",id:"dateInSchool",layout:{labelCol:"120px"}},{type:"input",label:"身份证号",col:"12",rules:[{required:!0,message:"身份证号不能为空"},{validator:t.checkIdCard}],id:"idNum",layout:{labelCol:"120px"}},{type:"radio",label:"性别",col:"12",id:"sex",options:[{label:"男",value:"男"},{label:"女",value:"女"}],layout:{labelCol:"120px"}},{type:"input",label:"宿舍室号",col:"12",id:"roomNum",layout:{labelCol:"120px"}},{type:"input",label:"宿舍楼号",col:"12",id:"roomBuilding",layout:{labelCol:"120px"}},{type:"inputNumber",label:"宿舍楼层",col:"12",id:"roomFloor",min:1,layout:{labelCol:"120px"}},{type:"inputNumber",label:"宿舍床号",col:"12",id:"roomBed",min:1,layout:{labelCol:"120px"}},{type:"input",label:"手机号",col:"12",id:"telPhone",rules:[{validator:t.checkTel}],layout:{labelCol:"120px"}},{type:"input",label:"邮箱",col:"12",id:"email",rules:[{validator:t.checkEma}],layout:{labelCol:"120px"}},{type:"cascader",label:"所属班级",rules:[{required:!0,message:"所属班级不能为空"}],col:"12",id:"classIds",options:c["a"].getters.classNameList||[],layout:{labelCol:"120px"}},{type:"input",label:"学生账号",col:"12",id:"loginId",rules:[{required:!0,message:"学生账号不能为空"}],layout:{labelCol:"120px"}},{type:"inputPassword",label:"密码",col:"12",id:"loginPwd",rules:[{required:!t.editInfo,min:7,message:"密码必须六位以上"}],layout:{labelCol:"120px"}}];return e},getInfoData:function(t){var e=[{type:"select",label:"学校名称",col:"20",options:c["a"].getters.schoolNameList||[],defaultValue:c["a"].getters.schoolNameList[0]?c["a"].getters.schoolNameList[0].value:"",id:"schoolId",layout:{labelCol:"100px"}},{type:"children",name:"button",col:24}];return e}},u=n("4bcd"),r=(n("d3b7"),n("b775")),d={getStudentForPage:"/student/getStudentForPage",getStudent:"/student/getStudent",delStudent:"/student/delStudent",saveStudent:"/student/saveStudent",updateStudent:"/student/updateStudent",getStudentById:"/student/getStudentById",importStudentInfo:"/import/importStudentInfo",importStudentCourseInfo:"/import/importStudentCourseInfo"};function p(t){return Object(r["b"])({url:d.getStudentForPage,method:"post",data:t})}function f(t){return Object(r["b"])({url:d.delStudent,method:"post",data:t})}function h(t){return Object(r["b"])({url:d.saveStudent,method:"post",data:t})}function m(t){return Object(r["b"])({url:d.updateStudent,method:"post",data:t})}function g(t){return Object(r["b"])({url:d.getStudentById,method:"post",data:t})}function b(t){return Object(r["b"])({url:d.importStudentInfo,method:"post",timeout:3e5,data:t})}function S(t){return Object(r["b"])({url:d.importStudentCourseInfo,method:"post",timeout:3e5,data:t})}var y={getStudentForPage:function(t){return new Promise((function(e,n){p(t).then((function(t){e(t||{})}))["catch"]((function(t){n(t)}))}))},delStudent:function(t){return new Promise((function(e,n){f(t).then((function(t){e(t)}))["catch"]((function(t){n(t)}))}))},saveStudent:function(t){return new Promise((function(e,n){h(t).then((function(t){e(t)}))["catch"]((function(t){n(t)}))}))},updateStudent:function(t){return new Promise((function(e,n){m(t).then((function(t){e(t)}))["catch"]((function(t){n(t)}))}))},getStudentById:function(t){return new Promise((function(e,n){g(t).then((function(t){e(t||{})}))["catch"]((function(t){n(t)}))}))},importStudentInfo:function(t){return new Promise((function(e,n){b(t).then((function(t){e(t)}))["catch"]((function(t){n(t)}))}))},importStudentCourseInfo:function(t){return new Promise((function(e,n){S(t).then((function(t){e(t)}))["catch"]((function(t){n(t)}))}))}},v=n("c1df"),I=n.n(v),x=[{title:"姓名",dataIndex:"name",key:"name"},{title:"学号",dataIndex:"studentNum",key:"studentNum"},{title:"所属学校",dataIndex:"schoolName",key:"schoolName"},{title:"所属班级",dataIndex:"className",key:"className"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],C={name:"Index",components:{GlobalForm:s["a"]},data:function(){return{columns:x,title:"新增学生",spinning:!1,visibleInfo:!1,loading:!0,searchData:{},selectedRowKeys:[],editInfo:null,visible:!1,data:[],pagination:{current:1,pageSize:20,total:0}}},computed:{getFormData:function(){return l.getFormData(this)},getInfoData:function(){return l.getInfoData(this)},getIncreaseForm:function(){return l.getIncreaseForm(this)}},created:function(){},mounted:function(){this.searchData={schoolId:this.$store.getters.selectSchoolInfo.value||""},this.getStudentForPage(Object(i["a"])({pageIndex:this.pagination.current,pageSize:this.pagination.pageSize},this.searchData))},methods:{checkIdCard:function(t,e,n){if(e&&!Object(u["b"])(e)){var a="请输入正确的身份证号";n(a)}else n()},checkTel:function(t,e,n){if(e&&!Object(u["c"])(e)){var a="请输入正确格式的号码";n(a)}else n()},checkEma:function(t,e,n){if(e&&!Object(u["a"])(e)){var a="请输入正确格式的邮箱";n(a)}else n()},changePage:function(t){this.pagination.current=t.current,this.getStudentForPage(Object(i["a"])({pageIndex:t.current,pageSize:this.pagination.pageSize},this.searchData))},increase:function(){this.title="新增学生",this.visible=!0,this.editInfo=null},onEdit:function(t){var e=this;y.getStudentById({id:t.id}).then((function(t){var n=e._.cloneDeep(t||{});e.title="编辑学生",e.editInfo=t,e.visible=!0,n.dateInSchool=n.dateInSchool?I()(n.dateInSchool,"YYYY-MM-DD"):null,e.$nextTick((function(){setTimeout((function(){e.$refs.increaseDom.setFieldsValue(e._.pick(n,"dateInSchool","name","studentNum","educationalSys","idNum","sex","roomNum","roomBuilding","roomFloor","roomBed","telPhone","email","classIds","loginId"))}))}))}))},handelOk:function(){var t=this.$refs.increaseDom.handleSubmit();t&&(this.editInfo?(t.dateInSchool=t.dateInSchool?I()(t.dateInSchool._d).format("YYYY-MM-DD"):"",this.updateStudent(Object(i["a"])(Object(i["a"])({},this.editInfo),t))):(t.dateInSchool=t.dateInSchool?I()(t.dateInSchool._d).format("YYYY-MM-DD"):"",this.saveStudent(t)),this.cancel())},cancel:function(){this.$refs.increaseDom.resetFields(),this.visible=!1},search:function(){var t=this.$refs.schoolSerch.getFieldsValue();this.searchData=Object(i["a"])(Object(i["a"])({},t),{},{schoolId:this.$store.getters.selectSchoolInfo.value||""}),this.pagination.current=1,this.getStudentForPage(Object(i["a"])({pageIndex:1,pageSize:this.pagination.pageSize},this.searchData))},reset:function(){this.$refs.schoolSerch.resetFields()},onSelectChange:function(t){this.selectedRowKeys=t},getStudentForPage:function(t){var e=this;this.loading=!0,y.getStudentForPage(t).then((function(t){e.data=t.records||[],e.pagination.total=t.total||0,e.loading=!1}))},saveStudent:function(t){var e=this;y.saveStudent(t).then((function(t){e.$notification.success({message:"新增成功"}),e.cancel(),e.getStudentForPage(Object(i["a"])({pageIndex:e.pagination.current,pageSize:e.pagination.pageSize},e.searchData))}))},updateStudent:function(t){var e=this;y.updateStudent(t).then((function(t){e.$notification.success({message:"更新成功"}),e.cancel(),e.getStudentForPage(Object(i["a"])({pageIndex:e.pagination.current,pageSize:e.pagination.pageSize},e.searchData))}))},delStu:function(t){this.delStudent({idList:[t.id]})},delStus:function(){this.delStudent({idList:this.selectedRowKeys})},delStudent:function(t){var e=this;y.delStudent(t).then((function(t){e.$notification.success({message:"删除成功"}),e.getStudentForPage(Object(i["a"])({pageIndex:e.pagination.current,pageSize:e.pagination.pageSize},e.searchData))}))},customRequest:function(t){var e=this,n=this.$store.getters.selectSchoolInfo||{};if(!n.value)return this.$notification.error({message:"学校信息不能为空",description:"请在右上角选择学校之后再上传"}),!0;this.spinning=!0;var a=new FormData;a.append("files",t.file),a.append("schoolId",n.id),a.append("importType",n.importType),y.importStudentInfo(a).then((function(t){e.$notification.success({message:"文件上传成功"}),e.spinning=!1,e.files=t}))["catch"]((function(){e.spinning=!1}))},customRequestBook:function(t){var e=this,n=this.$store.getters.selectSchoolInfo||{};if(!n.value)return this.$notification.error({message:"学校信息不能为空",description:"请在右上角选择学校之后再上传"}),!0;this.spinning=!0;var a=new FormData;a.append("files",t.file),a.append("schoolId",n.id),a.append("importType",n.importType),y.importStudentCourseInfo(a).then((function(t){e.$notification.success({message:"文件上传成功"}),e.spinning=!1,e.files=t}))["catch"]((function(){e.spinning=!1}))}}},k=C,D=(n("9a0c"),n("2877")),F=Object(D["a"])(k,a,o,!1,null,"47906a80",null);e["default"]=F.exports},"9a0c":function(t,e,n){"use strict";n("a816")},a816:function(t,e,n){}}]);